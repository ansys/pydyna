{% for link in links %}
{% for field in link.fields %}
{% if field.is_series and link.is_table_lookup %}
{# SeriesCard field with table lookup (e.g., element -> ELEMENT_BEAM) #}
    @property
    def {{field.name}}_links(self) -> typing.Dict[int, KeywordBase]:
        """Get all {{link.keyword_type}} keywords for {{field.name}}, keyed by element ID."""
        return self._get_links_from_series("{{link.keyword_type}}", "{{link.linkid}}", "{{field.name}}", "{{link.target_table_attr}}")

    def get_{{field.name}}_link(self, element_id: int) -> typing.Optional[KeywordBase]:
        """Get the {{link.keyword_type}} keyword containing the given element_id."""
        return self._get_link_by_attr("{{link.keyword_type}}", "{{link.linkid}}", element_id, "{{link.target_table_attr}}")

{% elif field.is_table and link.is_table_lookup %}
{# TableCard field with table lookup (e.g., pid -> PART): use helper methods #}
    @property
    def {{field.name}}_links(self) -> typing.Dict[int, KeywordBase]:
        """Get all {{link.keyword_type}} keywords for {{field.name}}, keyed by {{field.name}} value."""
        return self._get_links_from_table("{{link.keyword_type}}", "{{link.linkid}}", "{{field.table_name}}", "{{field.name}}", "{{link.target_table_attr}}")

    def get_{{field.name}}_link(self, {{field.name}}: int) -> typing.Optional[KeywordBase]:
        """Get the {{link.keyword_type}} keyword containing the given {{field.name}}."""
        return self._get_link_by_attr("{{link.keyword_type}}", "{{link.linkid}}", {{field.name}}, "{{link.target_table_attr}}")

{% elif field.is_table_group and field.key_field %}
{# Table-group field: generate *_links dict property and get_*_link(key) method #}
    @property
    def {{field.name}}_links(self) -> typing.Dict[int, KeywordBase]:
        """Get all {{link.keyword_type}}_* keywords for {{field.name}}, keyed by {{field.key_field}}."""
        return self._get_table_group_links("{{link.keyword_type}}", "{{link.linkid}}", "{{field.table_name}}", "{{field.name}}", "{{field.key_field}}")

    def get_{{field.name}}_link(self, {{field.key_field}}: int) -> typing.Optional[KeywordBase]:
        """Get the {{link.keyword_type}}_* keyword for the given {{field.key_field}}."""
        return self._get_table_group_link("{{link.keyword_type}}", "{{link.linkid}}", "{{field.table_name}}", "{{field.name}}", "{{field.key_field}}", {{field.key_field}})

{% elif link.is_multi_target %}
    @property
    def {{field.name}}_link(self) -> typing.Optional[KeywordBase]:
        """Get the linked DEFINE_CURVE or DEFINE_TABLE for {{field.name}}."""
        if self.deck is None:
            return None
        field_value = self.{{field.name}}
        if field_value is None or field_value == 0:
            return None
{% for target in link.targets %}
        for kwd in self.deck.get_kwds_by_full_type("{{target.type}}", "{{target.subtype}}"):
            if kwd.{{target.id_field}} == field_value:
                return kwd
{% endfor %}
        return None

    @{{field.name}}_link.setter
    def {{field.name}}_link(self, value: KeywordBase) -> None:
        """Set the linked keyword for {{field.name}}."""
        if hasattr(value, "lcid"):
            self.{{field.name}} = value.lcid
        elif hasattr(value, "tbid"):
            self.{{field.name}} = value.tbid

{% elif link.is_table_lookup and not field.is_table and not field.is_series %}
{# Scalar PART link: use helper method #}
    @property
    def {{field.name}}_link(self) -> typing.Optional[KeywordBase]:
        """Get the {{link.keyword_type}} keyword containing the given {{field.name}}."""
        return self._get_link_by_attr("{{link.keyword_type}}", "{{link.linkid}}", self.{{field.name}}, "parts")

{% elif link.is_polymorphic %}
    @property
    def {{field.name}}_link(self) -> typing.Optional[KeywordBase]:
        """Get the {{link.keyword_type}}_* keyword for {{field.name}}."""
        if self.deck is None:
            return None
        for kwd in self.deck.get_kwds_by_type("{{link.keyword_type}}"):
            if kwd.{{link.linkid}} == self.{{field.name}}:
                return kwd
        return None

    @{{field.name}}_link.setter
    def {{field.name}}_link(self, value: KeywordBase) -> None:
        """Set the {{link.keyword_type}}_* keyword for {{field.name}}."""
        self.{{field.name}} = value.{{link.linkid}}

{% elif link.is_subtype_prefix %}
    @property
    def {{field.name}}_link(self) -> typing.Optional[KeywordBase]:
        """Get the {{link.keyword_type}}_{{link.keyword_subtype}}_* keyword for {{field.name}}."""
        return self._get_set_link("{{link.keyword_subtype}}", self.{{field.name}})

    @{{field.name}}_link.setter
    def {{field.name}}_link(self, value: KeywordBase) -> None:
        """Set the {{link.keyword_type}}_{{link.keyword_subtype}}_* keyword for {{field.name}}."""
        self.{{field.name}} = value.{{link.linkid}}

{% else %}
    @property
    def {{field.name}}_link(self) -> typing.Optional[{{link.classname}}]:
        """Get the {{link.classname}} object for {{field.name}}."""
        if self.deck is None:
            return None
        for kwd in self.deck.get_kwds_by_full_type("{{link.keyword_type}}", "{{link.keyword_subtype}}"):
            if kwd.{{link.linkid}} == self.{{field.name}}:
                return kwd
        return None

    @{{field.name}}_link.setter
    def {{field.name}}_link(self, value: {{link.classname}}) -> None:
        """Set the {{link.classname}} object for {{field.name}}."""
        self.{{field.name}} = value.{{link.linkid}}

{% endif %}
{% endfor %}{# field in link.fields #}
{% endfor %}{# link in links #}