Refactor: Rework codegen 5
